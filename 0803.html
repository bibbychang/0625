<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>大富翁設定頁面</title>
  <style>
    #tile-palette img {
      width: 40px;
      margin: 5px;
      cursor: grab;
    }
    #map-grid {
      display: grid;
      grid-template-columns: repeat(8, 50px);
      grid-template-rows: repeat(8, 50px);
      gap: 2px;
      margin-top: 10px;
    }
    .grid-cell {
      width: 50px;
      height: 50px;
      border: 1px solid #aaa;
      background-color: #f0f0f0;
      position: relative;
    }
    .grid-cell img {
      width: 100%;
      height: 100%;
    }
    .grid-cell .label {
      position: absolute;
      bottom: 0;
      right: 2px;
      background: rgba(255,255,255,0.8);
      font-size: 10px;
      padding: 1px;
    }
  </style>
</head>
<body>
  <h1>大富翁遊戲設定</h1>

  <h2>選擇遊戲模式</h2>
  <label><input type="radio" name="mode" value="time" checked> 計時制</label>
  <select id="time-options">
    <option value="20">20 秒</option>
    <option value="50">50 秒</option>
    <option value="90">1 分半</option>
  </select>
  <label><input type="radio" name="mode" value="score"> 記分制</label>
  <select id="score-options" disabled>
    <option value="5">5 分</option>
    <option value="10">10 分</option>
    <option value="15">15 分</option>
  </select>

  <h2>選擇遊戲人數</h2>
  <select id="player-count">
    <option value="2">2 人</option>
    <option value="3">3 人</option>
    <option value="4">4 人</option>
  </select>

  <h2>選擇格子</h2>
  <div id="tile-palette">
    <img src="start.png" draggable="true" data-type="start">
    <img src="event.png" draggable="true" data-type="event">
    <img src="earthquake.png" draggable="true" data-type="earthquake">
    <img src="event1.png" draggable="true" data-type="event1">
    <img src="underdesk.png" draggable="true" data-type="underdesk">
    <img src="event2.png" draggable="true" data-type="event2">
    <img src="fire.png" draggable="true" data-type="fire">
    <img src="card.png" draggable="true" data-type="card">
    <img src="rain.png" draggable="true" data-type="rain">
    <img src="dice.png" draggable="true" data-type="dice">
  </div>

  <h2>地圖編輯 (8x8)</h2>
  <div id="map-grid"></div>

  <h2>載入預設地圖</h2>
  <button onclick="loadMap(1)">地圖 1</button>
  <button onclick="loadMap(2)">地圖 2</button>
  <button onclick="loadMap(3)">地圖 3</button>

  <h2></h2>
  <button onclick="startGame()">開始遊戲</button>

  <script>
    const grid = document.getElementById('map-grid');
    const mapData = Array.from({ length: 8 }, () => Array(8).fill(null));

    for (let row = 0; row < 8; row++) {
      for (let col = 0; col < 8; col++) {
        const cell = document.createElement('div');
        cell.className = 'grid-cell';
        cell.dataset.row = row;
        cell.dataset.col = col;
        cell.ondragover = e => e.preventDefault();
        cell.ondrop = e => {
          const type = e.dataTransfer.getData('text/plain');
          const index = row * 8 + col + 1;
          cell.innerHTML = `<img src="${type}.png"><div class="label">${index}</div>`;
          mapData[row][col] = `${index}:${type}`;
        };
        grid.appendChild(cell);
      }
    }

    document.querySelectorAll('#tile-palette img').forEach(img => {
      img.ondragstart = e => {
        e.dataTransfer.setData('text/plain', e.target.dataset.type);
      };
    });

    const timeSel = document.getElementById('time-options');
    const scoreSel = document.getElementById('score-options');
    document.querySelectorAll('input[name="mode"]').forEach(radio => {
      radio.onchange = () => {
        if (radio.value === 'time') {
          timeSel.disabled = false;
          scoreSel.disabled = true;
        } else {
          timeSel.disabled = true;
          scoreSel.disabled = false;
        }
      };
    });

    async function loadMap(id) {
      const response = await fetch('preset_maps.json');
      const data = await response.json();
      const selected = data[`map${id}`];

      for (let row = 0; row < 8; row++) {
        for (let col = 0; col < 8; col++) {
          const raw = selected[row][col];
          const [index, type] = raw.split(":");
          mapData[row][col] = raw;
          const cell = grid.children[row * 8 + col];
          cell.innerHTML = type ? `<img src="${type}.png"><div class="label">${index}</div>` : '';
        }
      }
    }

    function startGame() {
      const mode = document.querySelector('input[name="mode"]:checked').value;
      const time = timeSel.value;
      const score = scoreSel.value;
      const players = document.getElementById('player-count').value;

      localStorage.setItem('mapData', JSON.stringify(mapData));
      localStorage.setItem('mode', mode);
      localStorage.setItem('value', mode === 'time' ? time : score);
      localStorage.setItem('players', players);
      window.location.href = 'game.html';
    }
  </script>
</body>
</html>
